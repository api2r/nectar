<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>nectar design principles • nectar</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="nectar design principles"><meta property="og:image" content="https://nectar.api2r.org/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">nectar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9004</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jonthegeek/nectar/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.svg" class="logo" alt=""><h1>nectar design principles</h1>
      <small class="dont-index">Source: <a href="https://github.com/jonthegeek/nectar/blob/main/principles.md" class="external-link"><code>principles.md</code></a></small>
    </div>

<div id="nectar-design-principles" class="section level1">

<p><em>This is an experiment in making key package design principles explicit, versus</em> <em>only implicit in the code. The goal is to make maintenance easier, when spread</em> <em>out over time and across people.</em> <em>(borrowed from <a href="https://github.com/r-lib/usethis/blob/main/principles.md" class="external-link uri">https://github.com/r-lib/usethis/blob/main/principles.md</a>)</em></p>
<div class="section level2">
<h2 id="naming">naming<a class="anchor" aria-label="anchor" href="#naming"></a></h2>
<p>Function and argument names in this package reflect a tug-of-war between conventions used in <a href="https://httr2.r-lib.org/" class="external-link">{httr2}</a> and conventions used in the <a href="https://spec.openapis.org/oas/v3.1.0" class="external-link">OpenAPI Specification</a> (OAS). Use these rules to decide how to name things:</p>
<ul><li>Names should be <code>lower_snake_case</code>.</li>
<li>Names should be unique. For example, {httr2} uses <code>path</code> in several functions to refer to the URL path, but <code>req_cookie_preserve()</code> has a <code>path</code> argument for an on-disk location. We use <code>file_path</code> for this second argument.</li>
<li>Internal functions should begin with <code>.</code>. This is an older convention, but I find it useful for keeping my mental model of the package clear. If an unexported function is later exported, there will be work required to make sure the function is renamed everywhere, and I consider this a feature, not a bug; it makes it more likely that I’ll catch strange circular references and other sticking points.</li>
<li>If a sub-function (internal) is necessary to keep code clean and readable, but it doesn’t do anything unique other than implementing the function that’s calling it, append <code>_impl</code> (implementation) to the end of the function name. For example, <code><a href="reference/dot-req_path_append.html">.req_path_append()</a></code> calls <code>.req_path_append_impl()</code> when a <code>path</code> argument is provided.</li>
<li>Lean toward the {httr2} conventions for names. If a function modifies a request object, it should start with <code>req_</code>, and have an argument <code>req</code>. If a function modifies a response object, it should start with <code>resp_</code>, and have an argument <code>resp</code>. Exception: to keep documentation consistent, we use <code>resps</code> for functions that accept lists of <code>resp</code> objects, even if they also accept individual <code>resp</code> objects. In fact, all functions with <code>resps</code> arguments should deal with the case where <code>resp</code> is an individual response object.</li>
<li>If an argument name is confusing in {httr2}, it might be acceptable to rename it. But be very careful about this. See above about unique names, though.</li>
<li>Names should not overlap with {httr2} function names. A modified <code>req_perform()</code> cannot be named <code>req_perform()</code>.</li>
<li>If a function essentially translates from OAS to {httr2}, use OAS names for arguments, and {httr2} names for the function. However…</li>
<li>Arguments should be syntactic. Instead of <code>in</code> (used in <a href="https://spec.openapis.org/oas/v3.1.0#security-scheme-object" class="external-link">OAS Security Scheme Objects</a>), use <code>location</code>.</li>
</ul></div>
<div class="section level2">
<h2 id="documentation">documentation<a class="anchor" aria-label="anchor" href="#documentation"></a></h2>
<ul><li>All exported functions must be documented.</li>
<li>Ideally, internal functions should also be documented, with <code>@keywords internal</code>. They do not need a full description, but do include a one-line description in the “Title” area, and document their parameters. Most of the time, parameters will be documented in internal functions, and then inherited in the calling exported function (see below). Exception: <code>_impl()</code> functions do not need their own documentation; the parent function’s documentation covers the details in most or all cases.</li>
<li>Use <code>@inheritParams</code> liberally. Every parameter should be defined in exactly one place. This makes it much easier to maintain definitions. If you add a new parameter, globally search (ctrl-shift-F in RStudio) for <code>@param {name}</code> to make sure it isn’t already defined.</li>
<li>If a parameter is reused but doesn’t have a clear “home” (eg, <code>req</code> is used in several unrelated functions), define it in the <code>.shared-params</code> block of <code>aaa-shared.R</code>. It’s ok to err on the side of definining things there.</li>
<li>Likewise, if a return value is reused but doesn’t have a clear “home” (eg the <code><a href="https://httr2.r-lib.org/reference/request.html" class="external-link">httr2::request</a></code> objects returned by several functions), define it once in <code>aaa-shared.R</code> in a block with <code>@name .shared-{name}</code>, where <a href="https://github.com/christopherkenny/name" class="external-link">name</a> concisely describes the return value. Use this in function documentation with <code>@inherit .shared-{name} return</code>.</li>
<li>If a choice contradicts with the choice in {httr2}, explain and justify it in documentation. Make sure it is extremely clear when a default is different.</li>
</ul></div>
<div class="section level2">
<h2 id="testing">testing<a class="anchor" aria-label="anchor" href="#testing"></a></h2>
<p>TODO</p>
</div>
<div class="section level2">
<h2 id="motivation">motivation<a class="anchor" aria-label="anchor" href="#motivation"></a></h2>
<p>{nectar} is aimed at package writers who are wrapping APIs, particularly APIs with a clear OpenAPI specification. It is an intentionally opinionated framework, so it will make more assumptions than {httr2} about how you things should work. Let’s solve problems here once, and propogate those solutions out to API-wrapping packages that use nectar. I think that means {nectar} will often have two paths through a function: one when things are set up just-so and we can use information in the request or the class of an object to figure out precisely what to do, and then a fall-through for people who are using {nectar} but haven’t bought into the whole framework. The fall-through might fail in a lot of cases, but we should aim to make sure it works for the most common use case(s). That said, probably start with the fall-through in most new areas, and then refine/perfect.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jon Harmon, R Consortium.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

